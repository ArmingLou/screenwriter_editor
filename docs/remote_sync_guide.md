# 剧本编辑器远程同步功能使用指南

本文档介绍如何使用剧本编辑器的远程同步功能，实现移动设备与PC之间的文本内容同步。

## 功能概述

远程同步功能允许您：

- 在移动设备上编辑剧本，然后在PC上继续工作
- 在PC上编辑剧本，然后将内容推送到移动设备
- 通过WebSocket协议实现实时同步

## 在移动设备上设置

1. 打开剧本编辑器应用
2. 点击顶部工具栏中的同步图标（⟳）
3. 在远程同步设置页面：
   - 设置端口号（默认为8080）
   - 点击"启动服务器"按钮
   - 记下显示的WebSocket地址（例如：ws://192.168.1.100:8080）

![远程同步设置页面](sync_settings.png)

## 使用PC客户端模拟器进行测试

我们提供了一个简单的PC客户端模拟器，用于测试远程同步功能。

### 运行模拟器

```bash
cd your_project_directory
dart run tools/pc_client_simulator.dart
```

### 使用模拟器

1. 输入移动设备的IP地址和端口号
2. 连接成功后，可以使用以下命令：
   - `fetch` - 获取移动端编辑器内容
   - `push` - 推送内容到移动端编辑器
   - `exit` - 退出程序

## 协议说明

远程同步功能使用简单的JSON协议通过WebSocket通信：

### 从PC发送到移动设备的命令

1. **获取内容（fetch）**
   ```json
   {
     "type": "fetch"
   }
   ```

2. **推送内容（push）**
   ```json
   {
     "type": "push",
     "content": "要推送的文本内容"
   }
   ```

### 从移动设备发送到PC的响应

1. **内容响应**
   ```json
   {
     "type": "content",
     "content": "编辑器中的文本内容"
   }
   ```

## 与VSCode扩展集成

本功能设计用于与VSCode扩展配合使用。VSCode扩展开发中，将支持：

1. 连接到移动设备
2. 获取和编辑剧本内容
3. 将编辑后的内容推送回移动设备

## 故障排除

1. **无法连接到服务器**
   - 确保移动设备和PC在同一网络中
   - 检查防火墙设置，确保端口未被阻止
   - 尝试使用不同的端口

2. **连接断开**
   - 检查网络连接
   - 重启服务器
   - 确保移动设备未进入休眠状态

3. **内容同步问题**
   - 确保发送的内容格式正确
   - 检查是否有特殊字符导致解析错误

## 安全注意事项

- 远程同步功能不包含身份验证机制，仅适用于可信网络环境
- 不要在公共网络上使用此功能
- 考虑在未使用时停止服务器

## 未来计划

- 添加加密支持
- 实现用户身份验证
- 支持部分内容同步
- 添加冲突解决机制
